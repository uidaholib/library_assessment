<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Library Assessment</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet" type="text/css">
  <link href="https://unpkg.com/vuetify/dist/vuetify.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://js.arcgis.com/3.20compact/dijit/themes/claro/claro.css">

  <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/84BE7EF6-5E80-874A-8506-26292921C025/main.js"
    charset="UTF-8"></script>
  <link rel="stylesheet" crossorigin="anonymous" href="https://gc.kis.v2.scr.kaspersky-labs.com/520C12929262-6058-A478-08E5-6FE7EB48/abn/main.css"
  />
  <script src="https://js.arcgis.com/3.20compact/"></script>
  <script>
    require([
      "esri/arcgis/Portal", "esri/arcgis/OAuthInfo", "esri/IdentityManager",
      "dojo/dom-style", "dojo/dom-attr", "dojo/dom", "dojo/on", "dojo/_base/array",
      "dojo/domReady!"
    ], function (arcgisPortal, OAuthInfo, esriId,
      domStyle, domAttr, dom, on, arrayUtils) {
      var info = new OAuthInfo({
        appId: "q244Lb8gDRgWQ8hM",
        // Uncomment the next line and update if using your own portal
        portalUrl: "http://uidaho.maps.arcgis.com",
        // Uncomment the next line to prevent the user's signed in state from being shared
        // with other apps on the same domain with the same authNamespace value.
        authNamespace: "portal_oauth_inline",
        popup: true
      });
      esriId.registerOAuthInfos([info]);

      esriId.checkSignInStatus(info.portalUrl + "/sharing").then(
        function () {
          displayItems();
        }
      ).otherwise(
        function () {
          // Anonymous view
          console.log('error checking sign in');
        }
      );

      window.esriSiginIn = function(){
        esriId.getCredential(info.portalUrl + "/sharing");
      } 

      window.esriSignOut = function () {
        esriId.destroyCredentials();
        window.location.reload();

      }

      function displayItems() {
        new arcgisPortal.Portal(info.portalUrl).signIn().then(
          function (portalUser) {
            console.log("Signed in to the portal: ", portalUser);
            queryPortal(portalUser);
          }
        ).otherwise(
          function (error) {
            console.log("Error occurred while signing in: ", error);
          }
        );
      }

      function queryPortal(portalUser) {
        var portal = portalUser.portal;

        //See list of valid item types here:  http://www.arcgis.com/apidocs/rest/index.html?itemtypes.html
        //See search reference here:  http://www.arcgis.com/apidocs/rest/index.html?searchreference.html
        var queryParams = {
          q: "owner:" + portalUser.username,
          sortField: "numViews",
          sortOrder: "desc",
          num: 20
        };

        portal.queryItems(queryParams).then(createGallery);
      }

    });

  </script>
</head>

<body>
  <div id="app"></div>
  <!-- built files will be auto injected -->
</body>

</html>
